#!/usr/local/bin/node
"use strict";function _interopRequireDefault(a){return a&&a.__esModule?a:{"default":a}}function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function handle(a,b){functions.push(["string"==typeof a?function(b){return b[0]==a}:a,"string"==typeof b?function(a){return translate([b].concat(_toConsumableArray(a)))}:b])}function match(a){var b=!0,c=!1,d=void 0;try{for(var f,e=functions[Symbol.iterator]();!(b=(f=e.next()).done);b=!0){var g=f.value;if(g[0](a))return g[1]}}catch(h){c=!0,d=h}finally{try{!b&&e["return"]&&e["return"]()}finally{if(c)throw d}}return null}function translate(a){for(var b=!0;b;){var c=a;if(d=e=void 0,b=!1,!(c instanceof Array))return c.toString();var d=match(c);if(!d)return c[0]+"("+c.slice(1).map(function(a){return translate(a)}).join(", ")+")";var e=d(c.slice(1));if("string"==typeof e)return e;a=e,b=!0}}function lisp(a){var b=a.replace(/\(/g,"( ").replace(/\)/g," )").match(/'[^']*'|[^ ]+/g).join(" ").replace(/('[^']*'|[^ ]+)/g,'"$1"').replace(/"\(" /g,"[").replace(/ "\)"/g,"]").match(/\S+/g).join(", "),c=JSON.parse(b);return translate(c)}function write(a,b){return 1===b?console.log(a):_fs2["default"].writeFile(b,a,function(a){return console.log(a||"Compilation Done")})}var _fs=require("fs"),_fs2=_interopRequireDefault(_fs),_yargs=require("yargs"),functions=[];handle("+","add"),handle("-","sub"),handle("lambda","def"),handle("quote",function(a){return"["+a.map(function(a){return translate(a)}).join(", ")+"]"}),handle("if",function(a){return 2===a.length?"(function () {if ("+translate(a[0])+") {translate(args[1])}})":void 0}),handle("map",function(a){var b=translate(a[0]),c=translate(a[1]);return b+".map("+c+")"}),handle("with",function(a){var b=a.pop(),c=a.map(function(a){return a[0]}).join(","),d=a.map(function(a){return translate(a[1])}).join(",");return"(function("+c+") {\n      "+b.map(function(a){return translate(a)}).join(";\n")+"})("+d+");"}),handle("do",function(a){return"(function () {\n    "+(a.map(function(a){return translate(a)}).join(";\n")+";\n")+"\n})()"}),handle("def",function(a){var b=void 0,c=void 0,d=void 0;return 2==a.length?(c=a[1][0]instanceof Array?a[1]:[a[1]],d=a[0].join(", "),b=""):1==a.length?(c=a[0][0]instanceof Array?a[0]:[a[0]],d="",b=""):(b=a[0],d=a[1],c=a[2][0]instanceof Array?a[2]:[a[2]]),"function "+b+"("+d+") {\n  "+c.map(function(a){return translate(a)}).join(";\n")+";\n}"});var format=function(a){return a.replace(/\n+/g,"").replace(/\s+/," ").replace(/"/g,'\\"')};write(lisp(format(_fs2["default"].readFileSync(_yargs.argv._[0]).toString())),_yargs.argv.output||1);
